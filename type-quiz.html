<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brawl Stars: Skrifaðu nafnið</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    .container { max-width: 500px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    img { max-width: 200px; display: block; margin: 0 auto 16px; }
    input[type="text"] { width: 100%; padding: 8px; font-size: 1rem; margin-bottom: 12px; }
    button { padding: 8px 16px; font-size: 1rem; }
    .submit-btn { background: #0074d9; color: #fff; border: none; border-radius: 8px; transition: background 0.2s; }
    .submit-btn:hover { background: #005fa3; }
    .giveup-btn { background: #ff4136; color: #fff; border: none; border-radius: 8px; transition: background 0.2s; float: right; }
    .giveup-btn:hover { background: #c9302c; }
    .result { font-weight: bold; margin-top: 12px; }
    .back-link { display: block; margin-top: 24px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="quiz-title">...</h1>
    <div id="quiz-area">
      <img id="quiz-img" src="" alt="" />
      <input type="text" id="answer" placeholder="" autocomplete="off" />
      <button onclick="checkAnswer()" class="submit-btn">Senda inn</button>
      <button onclick="giveUp()" id="giveup-btn" class="giveup-btn">Ég gefst upp</button>
      <div style="clear:both;"></div>
      <div class="result" id="result"></div>
    </div>
    <a class="back-link" id="back-link" href="index.html"></a>
  </div>
  <script>
    let brawlers = [];
    let current = 0;
    let categoryConfig = {};
    let category = 'brawlstars';

    function getCategoryFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('category') || 'brawlstars';
    }

    function showBrawler() {
      if (brawlers.length === 0) return;
      document.getElementById('quiz-img').src = brawlers[current].img;
      document.getElementById('quiz-img').alt = categoryConfig.imgAlt || '';
      document.getElementById('answer').value = '';
      document.getElementById('result').textContent = '';
    }

    function checkAnswer() {
      if (brawlers.length === 0) return;
      const userAnswer = document.getElementById('answer').value.trim().toLowerCase();
      const correct = brawlers[current].name.toLowerCase();
      if (userAnswer === correct) {
        document.getElementById('result').textContent = 'Rétt!';
        current = (current + 1) % brawlers.length;
        setTimeout(showBrawler, 1000);
      } else {
        document.getElementById('result').textContent = 'Reyndu aftur!';
      }
    }

    function giveUp() {
      if (brawlers.length === 0) return;
      document.getElementById('result').textContent = 'Rétt svar: ' + brawlers[current].name;
      setTimeout(() => {
        current = (current + 1) % brawlers.length;
        showBrawler();
      }, 2000);
    }

    document.addEventListener('DOMContentLoaded', function() {
      category = getCategoryFromUrl();
      fetch('categories.json')
        .then(response => response.json())
        .then(categories => {
          // Use the first category if the requested one is missing
          if (!categories[category]) {
            category = Object.keys(categories)[0];
          }
          categoryConfig = categories[category];
          document.getElementById('quiz-title').textContent = categoryConfig.typeQuizTitle;
          document.getElementById('answer').placeholder = categoryConfig.inputPlaceholder;
          document.getElementById('quiz-img').alt = categoryConfig.imgAlt;
          document.getElementById('back-link').textContent = '\u2190 ' + (categoryConfig.backLink || 'Til baka í val á spurningakeppni');
          document.getElementById('back-link').href = 'index.html';
          // Use the key to determine the data file
          let dataFile = '/data/' + category + '.json';
          fetch(dataFile)
            .then(response => response.json())
            .then(data => {
              brawlers = shuffle(data);
              showBrawler();
            })
            .catch(err => {
              document.getElementById('quiz-area').innerHTML =
                `<img id="quiz-img" src="" alt="Brawler" />\n<div class="choices" id="choices"></div>\n<div class="result" id="result"></div>`;
            });
        });

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      document.getElementById('answer').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
          checkAnswer();
        }
      });
    });
  </script>
</body>
</html>
